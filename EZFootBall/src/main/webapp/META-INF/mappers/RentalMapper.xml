<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sample.dao.RentalDAO">
	<select id="rvListAll" resultType="GlistVO" parameterType="GlistVO">
		select game_code,game_type,field_name,GROUP_CONCAT(DATE_FORMAT(game_time, '%H') ORDER BY game_time asc)as game_time,game_gender,
		DATE_FORMAT(game_time, '%H') AS game_time,level,field_code,
		game_macth,game_place,close,game_pnum,game_mag,
		field_address,game_minp,game_maxp
		from gamelist
		<where>
			<if test="gameDay != null">
				and DATE_FORMAT(game_day, '%Y-%m-%d') = #{gameDay}
			</if>
			<if test="gamePlace != null">
				and game_place = #{gamePlace}
			</if>
			<if test="close != null">
				and close = #{close}
			</if>
			<if test="gameMacth != null">
				and game_macth = #{gameMacth}
			</if>
		</where>
		GROUP BY field_name, game_day
	</select>
	
<!-- 	<select id="selectTime" resultType="GlistVO"> -->
<!-- 		select field_name,GROUP_CONCAT(DATE_FORMAT(game_time, '%H')) as game_day from gamelist -->
<!-- 			<where> -->
<!-- 				<if test="gameDay != null"> -->
<!-- 					and DATE_FORMAT(game_day, '%Y-%m-%d') = #{gameDay} -->
<!-- 				</if> -->
<!-- 				<if test="fieldName != null"> -->
<!-- 					and field_name = #{fieldName} -->
<!-- 				</if> -->
<!-- 			</where> -->
<!-- 	</select> -->

	<select id="fieldInfo" resultType="gameFieldInfoVO">
		select field_code,field_name,field_address,field_rentalfee,field_type,
		field_img1,field_img2,field_img3,field_img4,field_img5,field_size,
		field_in_out,field_grass
		from gamefield_info where field_code = #{fieldCode}
	</select>
	
<!-- 	<select id="matchInfo" resultType="GlistVO"> -->
<!-- 		select game_code, game_day, game_time, game_macth,level -->
<!-- 		from gamelist where field_code = #{fieldCode} -->
<!-- 	</select> -->
	
	<!-- 마이페이지 구장예약 내역 불러오기 -->
	<select id="getFieldReservation" resultType="FieldReservationVO">
	    SELECT rv_code, CASE rv_type WHEN 'G' THEN '구장예약' WHEN 'T' THEN '팀매치' ELSE 'NULL' END rv_type,
        rv_day, field_code, field_name, field_address, field_type, field_rentalfee, user_code, user_payment,
        game_day, game_time, DATE_FORMAT(game_time, '%H:%i') game_time1, DATE_FORMAT(DATE_ADD(game_time, INTERVAL 2 HOUR), '%H:%i') game_time2 
        FROM field_reservation
		WHERE user_code = #{userCode}
	</select>
	
	
	<select id="rvListSelect" resultType="GlistVO">
		select game_code,game_type,field_name,GROUP_CONCAT(DATE_FORMAT(game_time, '%H') ORDER BY game_time asc)as game_time,game_gender,
		DATE_FORMAT(game_time, '%H') AS game_time,level,field_code,
		game_macth,game_place,close,game_pnum,game_mag,
		field_address,game_minp,game_maxp
		from gamelist
		<where>
			<if test="fieldCode != null">
				and field_code = #{fieldCode}
			</if>
			<if test="gameDay != null">
				and DATE_FORMAT(game_day, '%Y-%m-%d') = #{gameDay}
			</if>
		</where>
				GROUP BY field_name, game_day
	</select>
	
	
	<select id="rvCheck" resultType="int">
		select count(*) from field_reservation
		where user_code = #{userCode}
		and field_code = #{fieldCode}
		and game_day = #{gameDay}
		and game_time = #{gameTime}
		and rv_type = #{rvType}
	</select>
	
<!-- 	<select id="rvCheck" resultType="FieldReservationVO"> -->
<!-- 		select count(*) from field_reservation -->
<!-- 		<where>  -->
<!-- 		<if test="userCode != null"> -->
<!-- 			and user_code = #{userCode} -->
<!-- 		</if> -->
<!-- 		<if test="gameDay != null"> -->
<!-- 		and game_day = #{gameDay} -->
<!-- 		</if> -->
<!-- 		<if test="gameTime != null"> -->
<!-- 		and game_time = #{gameTime} -->
<!-- 		</if> -->
<!-- 		<if test="rvType != null"> -->
<!-- 		and rv_type = #{rvType} -->
<!-- 		</if> -->
<!-- 		</where> -->
<!-- 	</select> -->

	<insert id="insertFieldReservation" parameterType="FieldReservationVO">
		insert into field_reservation (rv_type,field_code,field_name,field_address,field_type,field_rentalfee,user_code,user_payment,game_day,game_time)
		values(#{rvType},#{fieldCode},#{fieldName},#{fieldAddress},#{fieldType},#{fieldRentalfee},#{userCode},#{userPayment},#{gameDay},#{gameTime})
	</insert>
	<insert id="insertRvInGameList" parameterType="GlistVO">
		insert into gamelist (game_type,field_code,field_name,field_address,game_macth,game_day,game_time)
		values(#{gameType},#{fieldCode},#{fieldName},#{fieldAddress},#{gameMacth},#{gameDay},#{gameTime});
	</insert>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>